{% extends 'base.html' %}
{% block title %}Secure Checkout{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-md-6">

            <h4 class="mb-3 text-white">Secure Checkout</h4>

            <!-- Django ркдрк░рклркерлА ркЖрк╡ркдрлЛ рк╕рк╛ркЪрлЛ Success Message -->
            {% if success %}
            <div class="alert alert-success text-center fw-bold">
                тЬЕ Order Completed Successfully! Thank you for shopping with us ЁЯШК
            </div>
            <!-- ркУрк░рлНркбрк░ рккрлВрк░рлЛ ркеркпрк╛ рккркЫрлА ркмркЯрки ркЫрлБрккрк╛рк╡рк╡рлБркВ рк╣рлЛркп ркдрлЛ -->
            <div class="text-center">
                <a href="/" class="btn btn-light">Go to Home</a>
            </div>
            {% else %}
            
            <!-- рклрлЛрк░рлНркоркирлА ркПрк░рк░ ркЕрк╣рлАркВ ркмркдрк╛рк╡рлЛ -->
            {% if form.errors %}
                <div class="alert alert-danger">
                    Please correct the errors below.
                </div>
            {% endif %}

            <form action="{% url 'checkout' %}" method="POST" id="payment-form">
                {% csrf_token %}

                <!-- Card Payment -->
                <div class="payment-option p-3 mb-3 bg-dark border rounded">
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="radio" name="payment_method" value="card" checked>
                        <label class="form-check-label fw-bold text-white">ЁЯТ│ Card</label>
                    </div>
                    <div id="card-details">
                        <input name="debit_card_number" type="text" id="card_num" class="form-control" placeholder="0000 0000 0000 0000" maxlength="19">
                        <div class="row g-2 mt-1">
                            <div class="col-6"><input name="mm_yy" type="text" class="form-control" placeholder="MM/YY"></div>
                            <div class="col-6"><input name="cvv" type="password" class="form-control" placeholder="CVV"></div>
                        </div>
                    </div>
                </div>

                <!-- UPI -->
                <div class="payment-option p-3 mb-3 bg-dark border rounded">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="payment_method" value="upi">
                        <label class="form-check-label text-white">UPI</label>
                    </div>
                    <div id="upi-details" style="display:none;">
                        <input name="upi_id" type="text" class="form-control mt-2" placeholder="yourname@upi">
                    </div>
                </div>

                <!-- COD -->
                <div class="payment-option p-3 mb-3 bg-dark border rounded">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="payment_method" value="cod">
                        <label class="form-check-label text-white">ЁЯТ░ Cash on Delivery</label>
                    </div>
                </div>

                <button type="submit" id="submit-btn" class="btn btn-primary w-100 py-3 mt-3">
                    Complete Order - тВ╣{{ total }}
                </button>
            </form>
            {% endif %} <!-- End of Success check -->
        </div>
    </div>
</div>

<script>
    const form = document.getElementById("payment-form");
    const cardDetails = document.getElementById("card-details");
    const upiDetails = document.getElementById("upi-details");
    const submitBtn = document.getElementById("submit-btn");

    // рккрлЗркорлЗркирлНркЯ ркорлЗркеркб ркЯрлЛркЧрк▓
    document.querySelectorAll('input[name="payment_method"]').forEach((radio) => {
        radio.addEventListener("change", function () {
            if (this.value === "card") {
                cardDetails.style.display = "block";
                upiDetails.style.display = "none";
            } else if (this.value === "upi") {
                cardDetails.style.display = "none";
                upiDetails.style.display = "block";
            } else {
                cardDetails.style.display = "none";
                upiDetails.style.display = "none";
            }
        });
    });

    // ркХрк╛рк░рлНркб ркиркВркмрк░ рклрлЛрк░рлНркорлЗркЯрк┐ркВркЧ
    document.getElementById("card_num")?.addEventListener("input", function (e) {
        e.target.value = e.target.value.replace(/\D/g, '').replace(/(.{4})/g, '$1 ').trim();
    });

    // рклрлЛрк░рлНрко рк╕ркмркорк┐ркЯ ркерк╛ркп ркдрлНркпрк╛рк░рлЗ рклркХрлНркд ркмркЯрки ркЯрлЗркХрлНрк╕рлНркЯ ркмркжрк▓рлЛ (Success ркорлЗрк╕рлЗркЬ Django ркмркдрк╛рк╡рк╢рлЗ)
    if(form) {
        form.addEventListener("submit", function (e) {
            // ркЕрк╣рлАркВ e.preventDefault() рки рк▓ркЦрк╡рлБркВ, ркирк╣рлАркВркдрк░ ркбрлЗркЯрк╛ рк╕рк░рлНрк╡рк░ рккрк░ ркирк╣рлАркВ ркЬрк╛ркп.
            submitBtn.disabled = true;
            submitBtn.innerText = "Processing Payment...";
        });
    }
</script>
{% endblock %}